# 91porn智能视频爬虫与推荐系统 - 详细项目计划

## 🎯 项目总目标

构建基于MediaCMS的智能91porn视频爬虫和推荐系统，实现：
- 自动爬取91porn视频（日榜、周榜、月榜前10）
- 智能视频存储和去重管理
- 双路召回推荐系统（关键词+语义搜索）
- 响应式Web界面（手机、平板、桌面）
- 单服务器部署优化

## 📋 详细实施计划

### 第一阶段：基础架构搭建 ✅ (已完成)

**目标**: 搭建完整的MediaCMS运行环境

**已完成任务**:
- ✅ 部署MediaCMS基础环境
- ✅ 验证核心功能正常运行
- ✅ 重新设计项目结构
- ✅ 编写完整项目文档
- ✅ 创建配置管理系统
- ✅ 开发自动化脚本
- ✅ 同步代码到GitHub

**验收标准**:
- ✅ MediaCMS成功启动，可以访问主页
- ✅ 可以上传测试视频并正常播放
- ✅ 搜索功能正常工作
- ✅ 用户注册登录功能正常

---

### 第二阶段：数据库扩展和模型设计 🔄 (进行中)

**目标**: 扩展MediaCMS数据库，添加91porn相关字段

#### 2.1 分析MediaCMS现有数据库结构
**任务**: 深入分析MediaCMS的数据库模型，理解表关系
**具体工作**:
- 分析`files/models/media.py`中的Media模型
- 理解MediaCMS的表结构和字段关系
- 研究现有的搜索和索引机制
- 分析用户、分类、标签等关联模型

**验收标准**:
- 完全理解MediaCMS的数据库架构
- 明确需要扩展的字段和表
- 确定数据迁移策略

#### 2.2 扩展Media模型
**任务**: 添加91porn相关字段到Media模型
**具体工作**:
- 添加字段：`heat`（热度）、`favorites`（收藏数）、`score`（评分）
- 添加字段：`rank_type`（排行榜类型）、`rank_date`（排行榜日期）、`rank_position`（排名位置）
- 添加字段：`viewkey`（91porn唯一标识）、`author`（作者）、`publish_date`（发布日期）
- 添加字段：`collection_volume`（收藏量）、`comments`（评论数）、`likes`（点赞数）、`dislikes`（点踩数）

**验收标准**:
- 所有新字段正确添加到Media模型
- 字段类型和约束设置合理
- 保持与现有字段的兼容性

#### 2.3 创建数据库迁移文件
**任务**: 创建Django迁移文件，执行字段扩展
**具体工作**:
- 使用`python manage.py makemigrations`创建迁移文件
- 编写自定义迁移逻辑（如果需要数据转换）
- 测试迁移文件的安全性

**验收标准**:
- 迁移文件创建成功
- 迁移可以安全执行
- 不会影响现有数据

#### 2.4 验证数据库扩展结果
**任务**: 验证字段扩展结果，确保正确添加
**具体工作**:
- 执行数据库迁移
- 验证新字段在数据库中正确创建
- 测试新字段的读写操作
- 更新Django Admin界面

**验收标准**:
- 数据库迁移成功执行
- 新字段可以正常读写
- Django Admin可以管理新字段

---

### 第三阶段：爬虫系统集成

**目标**: 将91porn爬虫集成到MediaCMS

#### 3.1 分析现有爬虫代码
**任务**: 分析现有spider91.py代码，理解爬虫逻辑
**具体工作**:
- 研究爬虫的核心逻辑和数据结构
- 理解Selenium的使用方式
- 分析视频信息提取方法
- 研究去重和存储逻辑

**验收标准**:
- 完全理解爬虫的工作原理
- 明确需要集成的功能模块
- 确定集成策略

#### 3.2 将爬虫集成到Django
**任务**: 创建Django管理命令，集成爬虫功能
**具体工作**:
- 创建`management/commands/crawl_91porn.py`
- 将爬虫逻辑封装为Django命令
- 集成到MediaCMS的模型系统
- 添加错误处理和日志记录

**验收标准**:
- 可以通过Django命令执行爬虫
- 爬虫结果正确保存到数据库
- 错误处理机制完善

#### 3.3 集成Selenium和Chrome驱动
**任务**: 集成Selenium和Chrome驱动到Django环境
**具体工作**:
- 在Docker环境中安装Chrome和ChromeDriver
- 配置Selenium WebDriver
- 处理年龄验证和反爬机制
- 优化浏览器性能和稳定性

**验收标准**:
- Selenium在Docker环境中正常工作
- 可以成功访问91porn网站
- 浏览器自动化稳定可靠

#### 3.4 实现排行榜爬取功能
**任务**: 实现日榜、周榜、月榜爬取功能
**具体工作**:
- 实现日榜爬取：`crawl_daily_ranking()`
- 实现周榜爬取：`crawl_weekly_ranking()`
- 实现月榜爬取：`crawl_monthly_ranking()`
- 添加排行榜数据验证

**验收标准**:
- 可以成功爬取三种排行榜
- 排行榜数据准确完整
- 支持配置爬取数量

#### 3.5 实现视频去重逻辑
**任务**: 实现多层级去重机制
**具体工作**:
- 基于viewkey的去重
- 基于标题相似度的去重
- 基于MD5哈希的去重
- 实现去重策略配置

**验收标准**:
- 去重逻辑准确有效
- 避免重复下载相同视频
- 去重性能良好

#### 3.6 集成到Celery任务队列
**任务**: 支持异步执行爬虫任务
**具体工作**:
- 创建Celery任务：`crawl_91porn_task`
- 实现定时任务调度
- 添加任务状态监控
- 实现任务失败重试

**验收标准**:
- 爬虫任务可以异步执行
- 支持定时自动爬取
- 任务状态可以监控

---

### 第四阶段：AI推荐系统构建

**目标**: 构建双路召回推荐系统

#### 4.1 安装和配置Chroma向量数据库
**任务**: 搭建向量数据库基础设施
**具体工作**:
- 在Docker环境中安装Chroma
- 配置Chroma数据库连接
- 创建视频向量集合
- 实现向量存储接口

**验收标准**:
- Chroma数据库正常运行
- 可以存储和检索向量数据
- 集成到Django环境

#### 4.2 集成BGE中文向量模型
**任务**: 实现中文文本向量化
**具体工作**:
- 下载和配置BGE-small-zh-v1.5模型
- 实现文本向量化服务
- 优化模型加载和推理性能
- 添加向量质量验证

**验收标准**:
- BGE模型成功加载
- 可以正确向量化中文文本
- 向量质量符合预期

#### 4.3 实现视频标题向量存储和检索
**任务**: 构建向量存储和检索系统
**具体工作**:
- 实现视频标题自动向量化
- 存储向量到Chroma数据库
- 实现向量相似度搜索
- 添加向量数据管理功能

**验收标准**:
- 视频标题自动向量化
- 向量相似度搜索正常工作
- 向量数据管理完善

#### 4.4 实现双路召回系统
**任务**: 构建关键词+语义混合搜索
**具体工作**:
- 保留PostgreSQL全文搜索
- 实现Chroma语义搜索
- 设计双路融合算法
- 创建统一搜索API

**验收标准**:
- 关键词搜索正常工作
- 语义搜索正常工作
- 双路融合结果合理

#### 4.5 构建推荐引擎
**任务**: 实现智能推荐功能
**具体工作**:
- 设计推荐算法
- 实现个性化推荐
- 添加推荐结果排序
- 实现推荐效果评估

**验收标准**:
- 推荐算法效果良好
- 支持个性化推荐
- 推荐结果相关性高

---

### 第五阶段：前端界面定制

**目标**: 创建用户友好的Web界面

#### 5.1 分析MediaCMS前端结构
**任务**: 理解React前端架构
**具体工作**:
- 分析React组件结构
- 理解路由和状态管理
- 研究UI组件库
- 分析响应式设计

**验收标准**:
- 完全理解前端架构
- 明确定制化需求
- 确定开发策略

#### 5.2 创建排行榜展示组件
**任务**: 实现排行榜UI展示
**具体工作**:
- 创建日榜展示组件
- 创建周榜展示组件
- 创建月榜展示组件
- 添加排行榜切换功能

**验收标准**:
- 排行榜页面正常显示
- 支持三种排行榜切换
- 界面美观易用

#### 5.3 创建推荐展示组件
**任务**: 实现推荐功能UI
**具体工作**:
- 创建推荐视频展示组件
- 实现推荐理由显示
- 添加推荐刷新功能
- 实现个性化推荐界面

**验收标准**:
- 推荐功能正常工作
- 推荐理由清晰显示
- 用户体验良好

#### 5.4 优化搜索界面
**任务**: 支持双路搜索功能
**具体工作**:
- 优化搜索输入界面
- 添加搜索类型选择
- 实现搜索结果展示
- 添加搜索历史功能

**验收标准**:
- 搜索界面功能完整
- 支持双路搜索
- 搜索结果展示清晰

#### 5.5 确保响应式设计
**任务**: 支持多设备访问
**具体工作**:
- 优化移动端界面
- 适配平板设备
- 确保桌面端体验
- 测试跨浏览器兼容性

**验收标准**:
- 移动端界面友好
- 平板设备适配良好
- 桌面端体验优秀

---

### 第六阶段：测试和优化

**目标**: 确保系统质量和性能

#### 6.1 编写单元测试
**任务**: 测试核心功能模块
**具体工作**:
- 测试爬虫功能
- 测试数据库操作
- 测试推荐算法
- 测试API接口

**验收标准**:
- 单元测试覆盖率>80%
- 所有核心功能测试通过
- 测试用例完整

#### 6.2 集成测试
**任务**: 验证各模块协作
**具体工作**:
- 测试爬虫到数据库流程
- 测试推荐系统集成
- 测试前后端协作
- 测试用户完整流程

**验收标准**:
- 各模块协作正常
- 数据流转正确
- 系统集成稳定

#### 6.3 性能测试
**任务**: 确保系统性能达标
**具体工作**:
- 测试搜索响应时间
- 测试推荐响应时间
- 测试并发访问能力
- 测试系统资源使用

**验收标准**:
- 搜索响应时间<500ms
- 推荐响应时间<1s
- 支持100+并发用户
- 资源使用合理

#### 6.4 用户体验测试
**任务**: 优化界面交互
**具体工作**:
- 测试用户操作流程
- 优化界面响应速度
- 改进错误提示
- 优化移动端体验

**验收标准**:
- 用户操作流畅
- 界面响应迅速
- 错误提示友好
- 移动端体验良好

---

### 第七阶段：生产环境部署

**目标**: 部署到生产环境并确保稳定运行

#### 7.1 配置生产环境
**任务**: 优化Docker和Nginx配置
**具体工作**:
- 优化Docker配置
- 配置Nginx反向代理
- 设置SSL证书
- 优化系统参数

**验收标准**:
- 生产环境配置正确
- 系统性能优化
- 安全配置完善

#### 7.2 设置监控和日志系统
**任务**: 实现系统监控
**具体工作**:
- 配置系统监控
- 设置日志收集
- 实现告警机制
- 添加性能监控

**验收标准**:
- 监控系统正常工作
- 日志收集完整
- 告警机制有效

#### 7.3 实施备份策略
**任务**: 确保数据安全
**具体工作**:
- 配置数据库备份
- 设置文件备份
- 实现自动备份
- 测试恢复流程

**验收标准**:
- 备份策略完善
- 自动备份正常
- 恢复流程可靠

#### 7.4 安全加固
**任务**: 提升系统安全性
**具体工作**:
- 配置防火墙
- 设置访问控制
- 加密敏感数据
- 定期安全更新

**验收标准**:
- 安全配置完善
- 访问控制有效
- 数据安全可靠

---

## 📊 项目时间线

| 阶段 | 预计时间 | 主要任务 | 关键里程碑 |
|------|----------|----------|------------|
| **第一阶段** | 已完成 | 基础架构搭建 | MediaCMS正常运行 |
| **第二阶段** | 2-3天 | 数据库扩展 | 数据库字段扩展完成 |
| **第三阶段** | 3-4天 | 爬虫系统集成 | 爬虫正常工作 |
| **第四阶段** | 4-5天 | AI推荐系统 | 双路召回完成 |
| **第五阶段** | 3-4天 | 前端界面定制 | 用户界面完成 |
| **第六阶段** | 2-3天 | 测试和优化 | 系统质量达标 |
| **第七阶段** | 2-3天 | 生产环境部署 | 系统稳定运行 |

**总计**: 16-22天

---

## 🎯 成功标准

**项目成功的最终标准**：
1. ✅ 可以自动爬取91porn视频并存储
2. ✅ 双路召回搜索功能正常工作
3. ✅ 排行榜功能完整可用
4. ✅ Web界面响应式设计，用户体验良好
5. ✅ 单服务器部署稳定运行
6. ✅ 系统性能满足预期（搜索<500ms，推荐<1s）
7. ✅ 代码质量高，文档完整

---

## 📝 注意事项

1. **开发顺序**: 严格按照阶段顺序进行，确保每个阶段完成后再进入下一阶段
2. **测试驱动**: 每个功能开发完成后立即进行测试
3. **文档更新**: 及时更新相关文档
4. **代码质量**: 保持代码整洁，添加适当注释
5. **性能监控**: 持续监控系统性能，及时优化
6. **安全考虑**: 始终考虑安全性，保护用户数据

这个计划确保了项目的系统性和可执行性，每个步骤都有明确的验收标准，确保项目能够按计划顺利完成！
